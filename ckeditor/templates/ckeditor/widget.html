<textarea{{ final_attrs|safe }}>{{ value }}</textarea>
<script type="text/javascript">
window.DJCKEDITOR = (typeof DJCKEDITOR == 'object') ? DJCKEDITOR : {configs:{}};

var feincms_richtext_remove_ckeditor, feincms_richtext_add_ckeditor;

if (typeof(feincms) != 'undefined' && typeof(feincms.jQuery) != 'undefined') {
    (function($){
        contentblock_init_handlers.push(function(){
            $('.order-machine textarea.item-richtext, #frontend_editor textarea.item-richtext').each(function(){
                feincms_richtext_add_ckeditor($(this));
            });

            contentblock_move_handlers.poorify.push(function(item) {
                item.find('textarea[class=item-richtext]').each(feincms_richtext_remove_ckeditor);
            });
            contentblock_move_handlers.richify.push(function(item) {
                item.find('textarea[class=item-richtext]').each(feincms_richtext_add_ckeditor);
            });
        });
    })(feincms.jQuery);

    function feincms_richtext_remove_ckeditor(field) {
        var id = field ? field.id : this.id;
        if (id in CKEDITOR.instances) {
            CKEDITOR.instances[id].destroy();
        }
    }

    function feincms_richtext_add_ckeditor(field) {
        var config_name = field.data('configName');
        field = $(field);
        var id = field.attr('id');
        if (id.indexOf('__prefix__') != -1 || id.substr(-6) == '-empty' || id.indexOf('_set-empty-') != -1) {
            return;
        }
        if (typeof(CKEDITOR.instances[id]) == 'undefined') {
            CKEDITOR.replace(id, DJCKEDITOR.configs[config_name]);
        }
    }
    
} else {
    (function() {
        var id = "{{ id }}";
        var config_name = '{{ config_name }}';
        if (id.indexOf('__prefix__') != -1 || id.substr(-6) == '-empty' || id.indexOf('_set-empty-') != -1) {
            return;
        }
        if (typeof(CKEDITOR.instances[id]) == 'undefined') {
            CKEDITOR.replace(id, DJCKEDITOR.configs[config_name]);
        }
    })();
}
</script>