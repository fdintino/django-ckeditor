/*
Copyright (c) 2003-2012, CKSource - Frederico Knabben. All rights reserved.
For licensing, see LICENSE.html or http://ckeditor.com/license
*/

CKEDITOR.plugins.add('codemirror',{requires:['sourcearea'],init:function(a){var b=this.path,b=['plugins/codemirror'].join(''),c=CKEDITOR.getUrl(b);if(c.indexOf('?')>0)c=c.substr(0,c.indexOf('?'));CKEDITOR.scriptLoader.load(CKEDITOR.getUrl(b+'/js/codemirror.min.js'));var d=CKEDITOR.getUrl(b+'/css/colors.css');a.element.getDocument().appendStyleSheet(d);a.on('mode',function(){if(a.mode=='source'){var e=a.textarea,f=e.getParent(),g=f.$.clientHeight+'px',h=f.$.clientWidth+'px',i=CodeMirror.fromTextArea(a.textarea.$,{stylesheet:d,path:c+'/js/',mode:'htmlmixed',passDelay:300,passTime:35,continuousScanning:1000,theme:'mac-classic',indentUnit:4,indentWithTabs:true,undoDepth:1,height:a.config.height||g,width:a.config.width||holderWidth,textWrapping:false,lineNumbers:false,enterMode:'flat',extraKeys:{"'>'":function(j){j.closeTag(j,'>');},"'/'":function(j){j.closeTag(j,'/');}}});if(a.config.width)i.setSize(a.config.width,null);a.on('beforeCommandExec',function(j){j.removeListener();a.textarea.setValue(i.getValue());a.fire('dataReady');});CKEDITOR.plugins.mirrorSnapshotCmd={exec:function(j){if(j.mode=='source'){j.textarea.setValue(i.getValue());j.fire('dataReady');}}};a.addCommand('mirrorSnapshot',CKEDITOR.plugins.mirrorSnapshotCmd);}});a.on('instanceReady',function(e){e.removeListener();if(a.mode=='wysiwyg'){var f=a.getData().indexOf('<?php');if(f!==-1)a.execCommand('source');}});}});
